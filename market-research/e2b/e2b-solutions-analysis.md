# E2B å¦‚ä½•è§£å†³ Firecracker å…¼å®¹æ€§é—®é¢˜

> E2B å®è·µåˆ†æï¼šå•†ä¸šåŒ– Agentic Infra å¹³å°çš„è§£å†³æ–¹æ¡ˆ
>
> åˆ›å»ºæ—¶é—´ï¼š2025-11-27

---

## E2B æ¦‚è¿°

E2B (https://e2b.dev) æ˜¯ç›®å‰æœ€æˆç†Ÿçš„å•†ä¸šåŒ– Agent Sandbox å¹³å°ï¼ŒåŸºäº Firecracker æ„å»ºã€‚é€šè¿‡åˆ†æå…¶äº§å“å’Œè¡Œä¸šå®è·µï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¹ å…¶è§£å†³å…¼å®¹æ€§é—®é¢˜çš„ç­–ç•¥ã€‚

---

## E2B çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ

### 1. ç¡¬ä»¶å’Œå¹³å°é™åˆ¶ â†’ **æ§åˆ¶åŸºç¡€è®¾æ–½** âœ…

**E2B çš„ç­–ç•¥ï¼šå®Œå…¨æ§åˆ¶éƒ¨ç½²ç¯å¢ƒ**

```yaml
é—®é¢˜ï¼šFirecracker éœ€è¦ KVM æ”¯æŒ

E2B è§£å†³æ–¹æ¡ˆï¼š
  ç­–ç•¥ï¼šä¸è®©ç”¨æˆ·è‡ªå·±éƒ¨ç½²ï¼Œå…¨éƒ¨æ‰˜ç®¡

  åŸºç¡€è®¾æ–½é€‰æ‹©ï¼š
    - ä½¿ç”¨ AWS è£¸é‡‘å±å®ä¾‹ï¼ˆi3.metal ç³»åˆ—ï¼‰
    - æˆ– GCP æ”¯æŒåµŒå¥—è™šæ‹ŸåŒ–çš„æœºå‹
    - å®Œå…¨é¿å…è™šæ‹ŸåŒ–ç¯å¢ƒ

  å¯¹ç”¨æˆ·ï¼š
    - âœ… ç”¨æˆ·æ— éœ€å…³å¿ƒ KVM
    - âœ… ç”¨æˆ·æ— éœ€å‡†å¤‡ç¡¬ä»¶
    - âœ… åªéœ€è°ƒç”¨ API
    - âŒ æ— æ³•ç§æœ‰éƒ¨ç½²ï¼ˆè¿™æ˜¯æƒè¡¡ï¼‰
```

**æ¶æ„ç¤ºä¾‹ï¼š**

```
ç”¨æˆ·ä»£ç ï¼ˆä»»ä½•ç¯å¢ƒï¼‰
    â†“ HTTPS API
E2B æ§åˆ¶å¹³é¢ï¼ˆå…¨çƒåˆ†å¸ƒï¼‰
    â†“ è°ƒåº¦
E2B è®¡ç®—èŠ‚ç‚¹ï¼ˆAWS i3.metalï¼‰
    â”œâ”€ è£¸é‡‘å±æœåŠ¡å™¨ï¼ˆæ”¯æŒ KVMï¼‰
    â”œâ”€ Firecracker microVM
    â””â”€ å®Œç¾å…¼å®¹
```

**å…³é”®æ´å¯Ÿï¼š**
> E2B é€šè¿‡ **SaaS æ¨¡å¼è§„é¿äº†éƒ¨ç½²å…¼å®¹æ€§é—®é¢˜**
> - ä¸æ˜¯è§£å†³å…¼å®¹æ€§ï¼Œè€Œæ˜¯**é¿å…ç”¨æˆ·é‡åˆ°å…¼å®¹æ€§é—®é¢˜**
> - æˆæœ¬æ›´é«˜ï¼Œä½†ä½“éªŒæ›´å¥½

**ç±»æ¯”ï¼š**
```
ä¼ ç»Ÿæ–¹æ¡ˆï¼šå–ä½ ä¸€è¾†è½¦ï¼Œä½ è‡ªå·±æ‰¾åœè½¦ä½ï¼ˆå¯èƒ½æ²¡æœ‰ï¼‰
E2B æ–¹æ¡ˆï¼šæä¾› Uber æœåŠ¡ï¼Œè½¦å’Œåœè½¦ä½éƒ½æ˜¯æˆ‘çš„
```

---

### 2. ç½‘ç»œé…ç½®å¤æ‚ â†’ **è‡ªåŠ¨åŒ– + å°è£…** âœ…

**E2B çš„ç­–ç•¥ï¼šå®Œå…¨è‡ªåŠ¨åŒ–ç½‘ç»œé…ç½®**

#### æ–¹æ¡ˆ Aï¼šé¢„é…ç½®ç½‘ç»œæ± 

```go
// E2B å¯èƒ½ä½¿ç”¨çš„ç½‘ç»œç®¡ç†æ–¹å¼
type NetworkPool struct {
    // é¢„åˆ›å»ºå¤§é‡ç½‘ç»œé…ç½®
    preallocatedNetworks []*NetworkConfig
    availableIPs         *IPPool
}

func (p *NetworkPool) Init() {
    // å¯åŠ¨æ—¶é¢„åˆ›å»º 1000 ä¸ªç½‘ç»œé…ç½®
    for i := 0; i < 1000; i++ {
        network := p.createNetwork(i)
        p.preallocatedNetworks = append(p.preallocatedNetworks, network)
    }
}

func (p *NetworkPool) AllocateForSandbox(sandboxID string) *NetworkConfig {
    // ç›´æ¥ä»æ± ä¸­åˆ†é…ï¼Œæ— éœ€å®æ—¶åˆ›å»º
    network := p.preallocatedNetworks[p.nextIndex]
    network.AssignTo(sandboxID)
    return network
}
```

**ä¼˜åŠ¿ï¼š**
- æ²™ç®±åˆ›å»ºæ—¶ç½‘ç»œå·²ç»å‡†å¤‡å¥½
- é¿å…åˆ›å»ºæ—¶çš„ç½‘ç»œé…ç½®å»¶è¿Ÿ
- æ‰¹é‡åˆ›å»ºå¯ä»¥ä¼˜åŒ–æ€§èƒ½

#### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ AWS VPC å’Œå®‰å…¨ç»„

```yaml
E2B å¯èƒ½çš„ç½‘ç»œæ¶æ„ï¼š

VPC å±‚ï¼š
  - æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹ç‹¬ç«‹ VPC
  - ä½¿ç”¨ AWS åŸç”Ÿç½‘ç»œï¼ˆé¿å… iptablesï¼‰

Firecracker ç½‘ç»œï¼š
  - TAP è®¾å¤‡è¿æ¥åˆ° VPC
  - é€šè¿‡ AWS Enhanced Networking
  - åˆ©ç”¨ SR-IOVï¼ˆç¡¬ä»¶è™šæ‹ŸåŒ–ï¼‰

ç«¯å£æ˜ å°„ï¼š
  - ä½¿ç”¨ AWS ALB/NLB
  - åŠ¨æ€è·¯ç”±åˆ°æ²™ç®±
  - é¿å…å¤§é‡ iptables è§„åˆ™
```

**æ¶æ„å›¾ï¼š**

```
                Internet
                    â†“
          AWS Application Load Balancer
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                       â†“
    VPC A (èŠ‚ç‚¹1)          VPC B (èŠ‚ç‚¹2)
        â†“                       â†“
    â”Œâ”€â”€â”€â”´â”€â”€â”€â”               â”Œâ”€â”€â”€â”´â”€â”€â”€â”
    â”‚ VM 1  â”‚               â”‚ VM 3  â”‚
    â”‚ VM 2  â”‚               â”‚ VM 4  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯ä¸ª VM çš„ç½‘ç»œï¼š
- TAP è®¾å¤‡è‡ªåŠ¨é…ç½®
- ENI (Elastic Network Interface) æ˜ å°„
- å®‰å…¨ç»„è‡ªåŠ¨ç®¡ç†
```

#### æ–¹æ¡ˆ Cï¼šè‡ªç ”ç½‘ç»œæ’ä»¶

```go
// E2B å¯èƒ½è‡ªç ”çš„é«˜æ€§èƒ½ç½‘ç»œæ–¹æ¡ˆ
type E2BNetworkPlugin struct {
    // ä½¿ç”¨ eBPF å®ç°é«˜æ€§èƒ½è·¯ç”±
    ebpfPrograms map[string]*ebpf.Program

    // TC (Traffic Control) å®ç°ç«¯å£æ˜ å°„
    tcRedirect *TCRedirect
}

func (p *E2BNetworkPlugin) SetupSandboxNetwork(sandboxID string) {
    // 1. åˆ›å»º veth pairï¼ˆæ¯” TAP æ›´å¿«ï¼‰
    veth := p.createVethPair(sandboxID)

    // 2. ä½¿ç”¨ eBPF å®ç° NATï¼ˆé¿å… iptablesï¼‰
    p.attachEBPFProgram(veth, sandboxID)

    // 3. TC redirect å®ç°ç«¯å£è½¬å‘
    p.setupTCRedirect(veth, sandboxID)
}
```

**å…³é”®æŠ€æœ¯ï¼š**
- **eBPF**ï¼šå†…æ ¸çº§ç½‘ç»œç¼–ç¨‹ï¼Œæ€§èƒ½æé«˜
- **TC redirect**ï¼šé¿å… iptables æ€§èƒ½é—®é¢˜
- **CNI æ’ä»¶**ï¼šæ ‡å‡†åŒ–æ¥å£

---

### 3. K8s é›†æˆå¤æ‚ â†’ **å¯èƒ½ä¸ç”¨ K8s** âœ…

**E2B çš„ç­–ç•¥ï¼šè‡ªç ”è½»é‡çº§è°ƒåº¦å™¨**

#### æ¨æµ‹çš„æ¶æ„

```
E2B å¯èƒ½ä¸ç›´æ¥ä½¿ç”¨ Kubernetesï¼Œè€Œæ˜¯ï¼š

è‡ªç ”è°ƒåº¦ç³»ç»Ÿï¼š
  - è½»é‡çº§è°ƒåº¦å™¨ï¼ˆGo å®ç°ï¼‰
  - ä¸“é—¨ä¸º Firecracker ä¼˜åŒ–
  - é¿å… K8s çš„å¤æ‚æ€§å’Œå¼€é”€

ç†ç”±ï¼š
  1. Firecracker ä¸æ˜¯å®¹å™¨ï¼ŒK8s é›†æˆå›°éš¾
  2. K8s å¤ªé‡ï¼ŒAgent åœºæ™¯ä¸éœ€è¦
  3. è‡ªç ”å¯ä»¥æ·±åº¦ä¼˜åŒ–æ€§èƒ½
  4. æ›´å®¹æ˜“å®ç°å¿«é€Ÿå¯åŠ¨ï¼ˆ< 200msï¼‰
```

**å¯èƒ½çš„å®ç°ï¼š**

```go
// E2B è‡ªç ”è°ƒåº¦å™¨ï¼ˆæ¨æµ‹ï¼‰
type Scheduler struct {
    nodes      []*ComputeNode
    loadBalance LoadBalancer
}

type ComputeNode struct {
    ID              string
    AvailableCPU    int
    AvailableMemory int64
    Sandboxes       map[string]*Sandbox
    FirecrackerMgr  *FirecrackerManager
}

func (s *Scheduler) ScheduleSandbox(req *CreateSandboxRequest) (*Sandbox, error) {
    // 1. é€‰æ‹©èŠ‚ç‚¹ï¼ˆç®€å•ç­–ç•¥ï¼šæœ€ç©ºé—²ï¼‰
    node := s.loadBalance.SelectNode(s.nodes)

    // 2. åœ¨èŠ‚ç‚¹ä¸Šåˆ›å»ºæ²™ç®±
    sandbox, err := node.FirecrackerMgr.Create(req)

    // 3. æ³¨å†Œè·¯ç”±
    s.registerRoute(sandbox)

    return sandbox, nil
}

// æ— éœ€ kubelet, etcd, controller-manager ç­‰å¤æ‚ç»„ä»¶
// ä¸“æ³¨äºæ²™ç®±è°ƒåº¦å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†
```

**å¯¹æ¯”ï¼š**

| ç»„ä»¶ | Kubernetes | E2B è‡ªç ” |
|------|-----------|----------|
| **è°ƒåº¦å™¨** | kube-schedulerï¼ˆå¤æ‚ï¼‰ | è‡ªç ”ï¼ˆç®€åŒ–ï¼‰ |
| **çŠ¶æ€å­˜å‚¨** | etcdï¼ˆé‡é‡çº§ï¼‰ | PostgreSQL/Redis |
| **èŠ‚ç‚¹ç®¡ç†** | kubeletï¼ˆé€šç”¨ï¼‰ | ä¸“ç”¨ Agent |
| **ç½‘ç»œ** | CNIï¼ˆæ ‡å‡†ä½†å¤æ‚ï¼‰ | è‡ªç ”ï¼ˆä¼˜åŒ–ï¼‰ |
| **å¯åŠ¨æ—¶é—´** | ç§’çº§ | **< 200ms** |

**å…³é”®æ´å¯Ÿï¼š**
> E2B å¯èƒ½**æ”¾å¼ƒäº† K8s çš„é€šç”¨æ€§ï¼Œæ¢å–äº†æè‡´æ€§èƒ½**

---

### 4. ç³»ç»Ÿè°ƒç”¨å…¼å®¹æ€§ â†’ **ä¸¥æ ¼æµ‹è¯• + é¢„æ„å»ºæ¨¡æ¿** âœ…

**E2B çš„ç­–ç•¥ï¼šæä¾›éªŒè¯è¿‡çš„æ¨¡æ¿**

#### æ¨¡æ¿éªŒè¯æµç¨‹

```yaml
E2B æ¨¡æ¿å‘å¸ƒæµç¨‹ï¼š

1. åŸºç¡€é•œåƒé€‰æ‹©ï¼š
   - Ubuntu 22.04ï¼ˆæœ€æ–° LTSï¼‰
   - Alpineï¼ˆè½»é‡çº§ï¼‰
   - è‡ªå®šä¹‰æœ€å°åŒ–é•œåƒ

2. è½¯ä»¶åŒ…æµ‹è¯•ï¼š
   - è‡ªåŠ¨åŒ–æµ‹è¯•æ‰€æœ‰é¢„è£…åŒ…
   - åœ¨ Firecracker ä¸­è¿è¡Œ 100+ æµ‹è¯•ç”¨ä¾‹
   - è®°å½•å…¼å®¹æ€§é—®é¢˜

3. é—®é¢˜ä¿®å¤ï¼š
   - æ›¿æ¢ä¸å…¼å®¹çš„åŒ…
   - è°ƒæ•´å†…æ ¸é…ç½®
   - æä¾› workaround

4. æ–‡æ¡£åŒ–ï¼š
   - åˆ—å‡ºå·²æµ‹è¯•çš„åŒ…
   - æ ‡æ³¨å·²çŸ¥é—®é¢˜
   - æä¾›æ›¿ä»£æ–¹æ¡ˆ

5. æŒç»­æ›´æ–°ï¼š
   - å®šæœŸé‡æ–°æµ‹è¯•
   - ç¤¾åŒºåé¦ˆé›†æˆ
   - ç‰ˆæœ¬æ§åˆ¶
```

**ç¤ºä¾‹ï¼šæµè§ˆå™¨æ¨¡æ¿**

```dockerfile
# E2B Browser æ¨¡æ¿ï¼ˆæ¨æµ‹å®ç°ï¼‰
FROM ubuntu:22.04

# 1. åŸºç¡€ä¾èµ–
RUN apt-get update && apt-get install -y \
    chromium-browser \
    xvfb \
    # ä»¥ä¸‹æ˜¯å…³é”®ï¼šFirecracker å…¼å®¹æ€§ä¿®å¤
    libnss3 \
    libgconf-2-4 \
    # ... ç»è¿‡æµ‹è¯•çš„ç‰¹å®šç‰ˆæœ¬

# 2. å¯åŠ¨è„šæœ¬ï¼ˆå¤„ç† Firecracker ç‰¹æ®Šæ€§ï¼‰
COPY start-browser.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/start-browser.sh

# 3. é¢„çƒ­ï¼ˆå‡å°‘é¦–æ¬¡å¯åŠ¨æ—¶é—´ï¼‰
RUN chromium-browser --headless --no-sandbox --dump-dom about:blank

# 4. æ¸…ç†ï¼ˆå‡å°é•œåƒå¤§å°ï¼‰
RUN apt-get clean && rm -rf /var/lib/apt/lists/*
```

**å…¼å®¹æ€§åˆ—è¡¨ï¼ˆæ¨æµ‹ï¼‰ï¼š**

```yaml
E2B å¯èƒ½ç»´æŠ¤çš„å…¼å®¹æ€§æ•°æ®åº“ï¼š

Python åŒ…ï¼š
  pandas: âœ… å®Œå…¨å…¼å®¹
  numpy: âœ… å®Œå…¨å…¼å®¹
  tensorflow: âš ï¸ éœ€è¦ç‰¹å®šç‰ˆæœ¬ 2.13.0
  pytorch: âœ… CPU ç‰ˆæœ¬å…¼å®¹
  opencv-python: âš ï¸ éœ€è¦é¢å¤–é…ç½®

æµè§ˆå™¨ï¼š
  chromium: âœ… v120+ æµ‹è¯•é€šè¿‡
  firefox: âœ… v121+ æµ‹è¯•é€šè¿‡
  playwright: âœ… å®Œå…¨å…¼å®¹
  selenium: âœ… éœ€è¦ --no-sandbox

å¼€å‘å·¥å…·ï¼š
  git: âœ… å®Œå…¨å…¼å®¹
  docker: âŒ ä¸æ”¯æŒï¼ˆåµŒå¥—è™šæ‹ŸåŒ–ï¼‰
  vscode-server: âœ… æµ‹è¯•é€šè¿‡
```

---

### 5. è°ƒè¯•å›°éš¾ â†’ **æä¾›è°ƒè¯•å·¥å…·** âœ…

**E2B çš„ç­–ç•¥ï¼šSDK å°è£… + å¼€å‘è€…å·¥å…·**

#### SDK æŠ½è±¡å±‚

```python
# E2B SDK æä¾›çš„è°ƒè¯•æ¥å£
from e2b import Sandbox

sandbox = Sandbox.create()

# 1. æ‰§è¡Œå‘½ä»¤ï¼ˆå°è£…äº†åº•å±‚å¤æ‚æ€§ï¼‰
result = sandbox.process.start_and_wait("ls -la")
print(result.stdout)

# 2. æ–‡ä»¶æ“ä½œï¼ˆä¸éœ€è¦çŸ¥é“å¦‚ä½•æŒ‚è½½ï¼‰
sandbox.filesystem.write("/app/test.py", "print('hello')")
content = sandbox.filesystem.read("/app/test.py")

# 3. æµå¼æ—¥å¿—ï¼ˆå®æ—¶æŸ¥çœ‹ï¼‰
for log in sandbox.logs.stream():
    print(log)

# 4. ç»ˆç«¯ï¼ˆç±»ä¼¼ docker execï¼‰
terminal = sandbox.terminal.start()
terminal.send("pwd")
output = terminal.receive()

# åº•å±‚å¯èƒ½æ˜¯ï¼š
# - SSH è¿æ¥
# - æˆ– Guest Agentï¼ˆç±»ä¼¼ QEMU GAï¼‰
# - æˆ–é€šè¿‡å…±äº«å†…å­˜
```

#### å¼€å‘è€…å·¥å…·

```typescript
// E2B CLI å·¥å…·ï¼ˆæ¨æµ‹ï¼‰
// æä¾›ç±»ä¼¼ docker çš„ä½“éªŒ

// è¿æ¥åˆ°æ²™ç®±
$ e2b sandbox attach <sandbox_id>
> pwd
/home/user
> ls
file1.txt  file2.py

// æŸ¥çœ‹æ—¥å¿—
$ e2b logs <sandbox_id> -f

// æ‰§è¡Œå‘½ä»¤
$ e2b exec <sandbox_id> "python script.py"

// å¤åˆ¶æ–‡ä»¶
$ e2b cp local.txt <sandbox_id>:/remote/path

// åº•å±‚å®ç°ï¼š
// - RESTful API è°ƒç”¨
// - WebSocket å®æ—¶é€šä¿¡
// - å°è£…äº†æ‰€æœ‰ Firecracker ç»†èŠ‚
```

#### Web Terminal

```yaml
E2B æ§åˆ¶å°åŠŸèƒ½ï¼š

Web ç»ˆç«¯ï¼š
  - æµè§ˆå™¨ç›´æ¥è®¿é—®æ²™ç®±ç»ˆç«¯
  - WebSocket + xterm.js
  - ç±»ä¼¼ VS Code Remote

æ–‡ä»¶æµè§ˆå™¨ï¼š
  - å¯è§†åŒ–æ–‡ä»¶ç³»ç»Ÿ
  - ä¸Šä¼ /ä¸‹è½½æ–‡ä»¶
  - åœ¨çº¿ç¼–è¾‘

èµ„æºç›‘æ§ï¼š
  - CPU/å†…å­˜å®æ—¶å›¾è¡¨
  - ç½‘ç»œæµé‡ç»Ÿè®¡
  - è¿›ç¨‹åˆ—è¡¨

å®ç°æ–¹å¼ï¼š
  - æ²™ç®±å†…è¿è¡Œ Agent
  - WebSocket åŒå‘é€šä¿¡
  - ç”¨æˆ·æ— æ„ŸçŸ¥åº•å±‚æŠ€æœ¯
```

---

### 6. é•œåƒç®¡ç†å¤æ‚ â†’ **é•œåƒæœåŠ¡ + Snapshotter** âœ…

**E2B çš„ç­–ç•¥ï¼šè‡ªå»ºé•œåƒæœåŠ¡**

#### é•œåƒæ„å»ºæµç¨‹

```yaml
E2B é•œåƒç³»ç»Ÿï¼ˆæ¨æµ‹æ¶æ„ï¼‰ï¼š

1. æ„å»ºé˜¶æ®µï¼š
   å¼€å‘è€…ä¸Šä¼  Dockerfile
   â†“
   E2B æ„å»ºæœåŠ¡ï¼ˆç±»ä¼¼ Docker Hubï¼‰
   â†“
   è½¬æ¢ä¸º Firecracker rootfs
   â†“
   å­˜å‚¨åˆ° S3

2. ä¼˜åŒ–ï¼š
   - ä½¿ç”¨ device-mapper å¿«ç…§
   - æˆ– ZFS/btrfs å†™æ—¶å¤åˆ¶
   - é¢„çƒ­å¸¸ç”¨é•œåƒåˆ°è®¡ç®—èŠ‚ç‚¹

3. åˆ†å‘ï¼š
   - å…¨çƒ CDN åŠ é€Ÿ
   - è®¡ç®—èŠ‚ç‚¹æœ¬åœ°ç¼“å­˜
   - å¢é‡æ›´æ–°
```

**å®ç°ç»†èŠ‚ï¼š**

```go
// E2B é•œåƒç®¡ç†å™¨ï¼ˆæ¨æµ‹ï¼‰
type ImageManager struct {
    s3Client     *s3.Client
    localCache   *Cache
    snapshotter  *DeviceMapperSnapshotter
}

func (m *ImageManager) PrepareImage(imageID string) (string, error) {
    // 1. æ£€æŸ¥æœ¬åœ°ç¼“å­˜
    if cached := m.localCache.Get(imageID); cached != nil {
        return cached.Path, nil
    }

    // 2. ä» S3 ä¸‹è½½ï¼ˆå‹ç¼©æ ¼å¼ï¼‰
    compressed := m.s3Client.Download(imageID)

    // 3. è§£å‹åˆ°æœ¬åœ°
    rootfs := m.decompress(compressed)

    // 4. åˆ›å»ºå¿«ç…§ï¼ˆç”¨äºå…‹éš†ï¼‰
    snapshot := m.snapshotter.CreateSnapshot(rootfs)

    // 5. ç¼“å­˜
    m.localCache.Set(imageID, snapshot)

    return snapshot.Path, nil
}

// å¿«é€Ÿå…‹éš†ï¼ˆç”¨äºæ²™ç®±åˆ›å»ºï¼‰
func (m *ImageManager) CloneImage(baseImageID string) (string, error) {
    base := m.PrepareImage(baseImageID)

    // ä½¿ç”¨ COW å¿«ç…§ï¼Œæ¯«ç§’çº§
    clone := m.snapshotter.Clone(base)

    return clone, nil
}
```

**å…³é”®æŠ€æœ¯ï¼š**

```yaml
Device Mapper Thin Provisioningï¼š
  - å—çº§ COWï¼ˆCopy-on-Writeï¼‰
  - å…‹éš†é€Ÿåº¦æå¿«ï¼ˆ< 10msï¼‰
  - èŠ‚çœå­˜å‚¨ç©ºé—´
  - Linux å†…æ ¸åŸç”Ÿæ”¯æŒ

ä¼˜åŒ–ç­–ç•¥ï¼š
  1. é•œåƒåˆ†å±‚ï¼ˆç±»ä¼¼ Docker layersï¼‰
  2. åªå­˜å‚¨å·®å¼‚ï¼ˆdeltaï¼‰
  3. å‹ç¼©ä¼ è¾“ï¼ˆzstdï¼‰
  4. æœ¬åœ°ç¼“å­˜é¢„çƒ­
  5. P2P åˆ†å‘ï¼ˆå¤§è§„æ¨¡éƒ¨ç½²ï¼‰
```

---

## E2B çš„ç»¼åˆæ¶æ„ï¼ˆæ¨æµ‹ï¼‰

### å®Œæ•´æŠ€æœ¯æ ˆ

```yaml
å®¢æˆ·ç«¯å±‚ï¼š
  - Python SDKï¼ˆå®˜æ–¹ï¼‰
  - JavaScript SDKï¼ˆå®˜æ–¹ï¼‰
  - CLI å·¥å…·
  - Web æ§åˆ¶å°

API å±‚ï¼š
  - RESTful APIï¼ˆGoï¼‰
  - WebSocketï¼ˆå®æ—¶é€šä¿¡ï¼‰
  - gRPCï¼ˆå†…éƒ¨æœåŠ¡ï¼‰

æ§åˆ¶å¹³é¢ï¼š
  - è°ƒåº¦å™¨ï¼ˆè‡ªç ”ï¼Œé K8sï¼‰
  - è®¤è¯æˆæƒï¼ˆJWTï¼‰
  - è®¡è´¹ç³»ç»Ÿï¼ˆå®æ—¶è®¡é‡ï¼‰
  - ç›‘æ§å‘Šè­¦ï¼ˆPrometheusï¼‰

è®¡ç®—èŠ‚ç‚¹ï¼š
  - AWS i3.metalï¼ˆè£¸é‡‘å±ï¼‰
  - Firecracker è¿è¡Œæ—¶
  - è‡ªç ”ç½‘ç»œæ’ä»¶ï¼ˆeBPFï¼‰
  - é•œåƒç¼“å­˜ï¼ˆæœ¬åœ° SSDï¼‰

æ•°æ®å±‚ï¼š
  - PostgreSQLï¼ˆå…ƒæ•°æ®ï¼‰
  - Redisï¼ˆç¼“å­˜ã€é˜Ÿåˆ—ï¼‰
  - S3ï¼ˆé•œåƒã€å¿«ç…§ï¼‰
  - InfluxDBï¼ˆæ—¶åºæ•°æ®ï¼‰
```

### éƒ¨ç½²æ¶æ„

```
                  ç”¨æˆ·
                   â†“
         å…¨çƒ Anycast DNS
                   â†“
          CloudFlare CDN
                   â†“
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â†“                   â†“
    ç¾å›½ Region         æ¬§æ´² Region
         â†“                   â†“
   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
   â†“           â†“       â†“           â†“
API èŠ‚ç‚¹   è®¡ç®—èŠ‚ç‚¹  API èŠ‚ç‚¹   è®¡ç®—èŠ‚ç‚¹
   â†“           â†“       â†“           â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
           â†“                   â†“
    å…±äº«æ•°æ®å±‚          å…±äº«æ•°æ®å±‚
  (PostgreSQL RDS)    (PostgreSQL RDS)
```

---

## E2B è§£å†³æ–¹æ¡ˆæ€»ç»“

### æ ¸å¿ƒç­–ç•¥å¯¹æ¯”

| é—®é¢˜ | ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆè‡ªå·±è§£å†³ï¼‰ | E2B æ–¹æ¡ˆï¼ˆè§„é¿é—®é¢˜ï¼‰ |
|------|---------------------|---------------------|
| **KVM æ”¯æŒ** | æ£€æµ‹ç¯å¢ƒï¼Œæä¾›å¤šè¿è¡Œæ—¶ | åªéƒ¨ç½²åœ¨æ”¯æŒ KVM çš„è£¸é‡‘å±ä¸Š |
| **ç½‘ç»œå¤æ‚** | ç”¨æˆ·è‡ªå·±é…ç½® | å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ |
| **K8s é›†æˆ** | ä½¿ç”¨ K8s + Operator | è‡ªç ”è½»é‡çº§è°ƒåº¦å™¨ |
| **ç³»ç»Ÿè°ƒç”¨** | ç”¨æˆ·è‡ªå·±æµ‹è¯• | æä¾›éªŒè¯è¿‡çš„æ¨¡æ¿ |
| **è°ƒè¯•å›°éš¾** | æä¾›æ–‡æ¡£ | SDK å°è£… + Web å·¥å…· |
| **é•œåƒç®¡ç†** | ç”¨æˆ·è‡ªå·±è½¬æ¢ | è‡ªåŠ¨è½¬æ¢ + å¿«ç…§æœåŠ¡ |

### E2B æˆåŠŸçš„å…³é”®

#### 1. **æ‰˜ç®¡ä¸ºç‹** ğŸ†
```
ä¸è§£å†³å…¼å®¹æ€§é—®é¢˜ï¼Œè€Œæ˜¯è§„é¿é—®é¢˜
- ç”¨æˆ·ï¼šæ— éœ€å…³å¿ƒåŸºç¡€è®¾æ–½
- E2Bï¼šå®Œå…¨æ§åˆ¶ç¯å¢ƒ
- ç»“æœï¼šé›¶å…¼å®¹æ€§é—®é¢˜
```

#### 2. **æ·±åº¦ä¼˜åŒ–** âš¡
```
ä¸“æ³¨å•ä¸€æŠ€æœ¯æ ˆï¼ˆFirecrackerï¼‰
- ä¸è¿½æ±‚é€šç”¨æ€§
- æ·±åº¦ä¼˜åŒ–æ€§èƒ½
- å¯åŠ¨æ—¶é—´ < 200ms
```

#### 3. **ä¼˜ç§€çš„æŠ½è±¡** ğŸ¨
```
SDK éšè—æ‰€æœ‰å¤æ‚æ€§
- ç”¨æˆ·ï¼š3 è¡Œä»£ç æå®š
- åº•å±‚ï¼šå¤æ‚çš„ç½‘ç»œã€è°ƒåº¦
- ç»“æœï¼šå¼€å‘è€…ä½“éªŒæä½³
```

#### 4. **å•†ä¸šæ¨¡å¼æ”¯æ’‘** ğŸ’°
```
SaaS æ”¶è´¹æ”¯æŒé«˜æˆæœ¬åŸºç¡€è®¾æ–½
- è£¸é‡‘å±æœåŠ¡å™¨ï¼ˆè´µï¼‰
- å…¨çƒéƒ¨ç½²ï¼ˆè´µï¼‰
- ä¸“ä¸šå›¢é˜Ÿï¼ˆè´µï¼‰
```

---

## å¯¹ä½ çš„é¡¹ç›®çš„å¯ç¤º

### ç­–ç•¥é€‰æ‹©

#### å¦‚æœèµ° E2B è·¯çº¿ï¼ˆæ¨èï¼‰ï¼š

```yaml
ä¼˜åŠ¿ï¼š
  - å®Œå…¨æ§åˆ¶ç¯å¢ƒ
  - ç”¨æˆ·ä½“éªŒæœ€å¥½
  - æŠ€æœ¯é£é™©æœ€ä½

ä»£ä»·ï¼š
  - åŸºç¡€è®¾æ–½æˆæœ¬é«˜
  - è¿ç»´å¤æ‚åº¦é«˜
  - æ— æ³•ç§æœ‰éƒ¨ç½²

é€‚åˆåœºæ™¯ï¼š
  - SaaS ä¸ºä¸»
  - èµ„é‡‘å……è¶³
  - è¿½æ±‚æè‡´ä½“éªŒ
```

#### å¦‚æœèµ°æ··åˆè·¯çº¿ï¼ˆçµæ´»ï¼‰ï¼š

```yaml
æ–¹æ¡ˆï¼š
  1. SaaS æœåŠ¡ï¼ˆå­¦ E2Bï¼‰
  2. ç§æœ‰éƒ¨ç½²ï¼ˆç”¨æˆ·è‡ªå·±è§£å†³å…¼å®¹æ€§ï¼‰
  3. å¤šè¿è¡Œæ—¶ï¼ˆFirecracker + gVisor + å®¹å™¨ï¼‰

ä¼˜åŠ¿ï¼š
  - é€‚åº”ä¸åŒå®¢æˆ·éœ€æ±‚
  - çµæ´»æ€§é«˜
  - å¸‚åœºè¦†ç›–å¹¿

ä»£ä»·ï¼š
  - ç»´æŠ¤å¤šå¥—æ–¹æ¡ˆ
  - å¤æ‚åº¦å¢åŠ 
```

### å…·ä½“å»ºè®®

#### MVP é˜¶æ®µï¼ˆ3ä¸ªæœˆï¼‰ï¼š

```yaml
å­¦ E2B ä½†ç®€åŒ–ï¼š

åŸºç¡€è®¾æ–½ï¼š
  - ç§Ÿç”¨é˜¿é‡Œäº‘è£¸é‡‘å±ï¼ˆæˆ– AWSï¼‰
  - å•åŒºåŸŸéƒ¨ç½²ï¼ˆé™ä½æˆæœ¬ï¼‰
  - è‡ªç ”è½»é‡çº§è°ƒåº¦å™¨

ç½‘ç»œï¼š
  - ä½¿ç”¨æˆç†Ÿ CNI æ’ä»¶
  - ä¸è‡ªç ” eBPFï¼ˆå¤ªå¤æ‚ï¼‰

é•œåƒï¼š
  - å…ˆæä¾›å›ºå®šæ¨¡æ¿
  - åç»­å†æ”¯æŒè‡ªå®šä¹‰

è°ƒè¯•ï¼š
  - SDK åŸºç¡€å°è£…
  - Web Terminal åç»­å†åš
```

#### V1.0 é˜¶æ®µï¼ˆ6ä¸ªæœˆï¼‰ï¼š

```yaml
æ·±åº¦ä¼˜åŒ–ï¼š
  - ä¼˜åŒ–ç½‘ç»œæ€§èƒ½
  - é•œåƒå¿«ç…§ç³»ç»Ÿ
  - å¤šåŒºåŸŸéƒ¨ç½²
  - Web æ§åˆ¶å°
```

#### å…³é”®æŠ€æœ¯æŠ•å…¥ï¼š

```yaml
å¿…é¡»åšï¼š
  âœ… è‡ªåŠ¨åŒ–ç½‘ç»œé…ç½®ï¼ˆCNIï¼‰
  âœ… é•œåƒå¿«ç…§ç³»ç»Ÿï¼ˆdevice-mapperï¼‰
  âœ… SDK å°è£…ï¼ˆPython/JSï¼‰
  âœ… ç›‘æ§å’Œæ—¥å¿—

å¯ä»¥æ™šç‚¹åšï¼š
  â¸ eBPF ç½‘ç»œä¼˜åŒ–
  â¸ Web Terminal
  â¸ è‡ªå®šä¹‰é•œåƒä¸Šä¼ 
  â¸ å¤šè¿è¡Œæ—¶æ”¯æŒ
```

---

## ç»“è®º

### E2B çš„æ ¸å¿ƒæ™ºæ…§

**ä¸æ˜¯"è§£å†³"Firecracker çš„å…¼å®¹æ€§é—®é¢˜ï¼Œè€Œæ˜¯ï¼š**

1. **è§„é¿é—®é¢˜**ï¼šåªåœ¨æ”¯æŒçš„ç¯å¢ƒéƒ¨ç½²
2. **å°è£…å¤æ‚æ€§**ï¼šSDK éšè—æ‰€æœ‰ç»†èŠ‚
3. **æä¾›ä»·å€¼**ï¼šæè‡´çš„å¼€å‘è€…ä½“éªŒ
4. **å•†ä¸šåŒ–æ”¯æ’‘**ï¼šSaaS æ”¶è´¹è¦†ç›–é«˜æˆæœ¬

### å¯¹ä½ çš„å¯ç¤º

**çŸ­æœŸï¼ˆMVPï¼‰ï¼š**
- å­¦ä¹  E2B çš„ç®€åŒ–ç‰ˆæœ¬
- æ‰˜ç®¡éƒ¨ç½²ï¼Œæ§åˆ¶ç¯å¢ƒ
- èšç„¦æ ¸å¿ƒåŠŸèƒ½

**ä¸­æœŸï¼ˆV1.0ï¼‰ï¼š**
- æ·±åº¦ä¼˜åŒ–æ€§èƒ½
- å®Œå–„å¼€å‘è€…å·¥å…·
- å¤šåŒºåŸŸéƒ¨ç½²

**é•¿æœŸï¼ˆV2.0ï¼‰ï¼š**
- æä¾›ç§æœ‰éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰
- æ”¯æŒæ›´å¤šè¿è¡Œæ—¶ï¼ˆå¯é€‰ï¼‰
- å»ºè®¾ç”Ÿæ€

### æœ€é‡è¦çš„ä¸€ç‚¹

> **E2B çš„æˆåŠŸä¸åœ¨äºæŠ€æœ¯æœ‰å¤šå¤æ‚ï¼Œè€Œåœ¨äºï¼š**
> 1. è§£å†³äº†çœŸå®çš„ç”¨æˆ·ç—›ç‚¹
> 2. æä¾›äº†æè‡´çš„å¼€å‘è€…ä½“éªŒ
> 3. å•†ä¸šæ¨¡å¼èƒ½æ”¯æ’‘é«˜æˆæœ¬åŸºç¡€è®¾æ–½

**æŠ€æœ¯åªæ˜¯æ‰‹æ®µï¼Œç”¨æˆ·ä»·å€¼æ‰æ˜¯ç›®æ ‡ï¼** ğŸ¯

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*
*æœ€åæ›´æ–°ï¼š2025-11-27*

## å‚è€ƒèµ„æ–™

- E2B å®˜æ–¹æ–‡æ¡£ï¼šhttps://e2b.dev/docs
- E2B GitHubï¼šhttps://github.com/e2b-dev
- Firecracker GitHubï¼šhttps://github.com/firecracker-microvm/firecracker
- AWS è£¸é‡‘å±å®ä¾‹ï¼šhttps://aws.amazon.com/ec2/instance-types/
